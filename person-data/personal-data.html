<div class="personal-data">
    <div class="personal-data--info">
        <div class="personal-data--info__left">
            <div class="personal-data--info--img">
                <img src="/images/user.jpg" />
            </div>
            <div class="personal-data--info--name">
                <div class="personal-data--name-head">
                    <h3>Hi！默默鱼</h3>
                    <img src="/images/verson.png" />
                </div>
                <p>今天是你陪伴青瓜传媒的第</br><span>30</span>天</p>
            </div>
        </div>
        <div class="personal-data--info__right">
            <div class="personal-data--info-other is-none">
                <div>
                    <img src="/images/dianh.png" />
                    1593***2455
                </div>
                <div>
                    <img src="/images/gsrz.png" />
                    厦门青瓜传媒信息科技有限公司
                </div>
                <div>
                    <img src="/images/cc-card.png" style="width: 21px;" />
                    商务部 总监
                </div>
            </div>
            <div class="personal-data--info-other2">
                <p>您还没有完善青瓜名片哦～</p>
                <button class="edit-zl"><img src="/images/bj.png" />编辑资料</button>
            </div>
            <div class="personal-data--info-card">
                <img src="/images/qrcode2.png" />
                <p>扫一扫分享合作名片</p>
            </div>
        </div>
    </div>
    <div class="personal-data-content">
        <div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
            <ul class="layui-tab-title">
                <li class="layui-this personal-data1">个人中心</li>
                <li class="safe-setting">安全设置</li>
            </ul>
            <div class="layui-tab-content">
                <div class="layui-tab-item layui-show personal-data-cont">
                    <form class="layui-form" action="">
                        <div class="layui-form-item">
                            <label class="layui-form-label required">头像</label>
                            <div class="layui-input-block jsfs" id="user-head">
                                <div class="upload-image">
                                    <img src="/images/add.png" />
                                    <p>上传头像</p>
                                </div>
                                <img class="upload-show" src="/images/user.jpg" />
                                <div id="demo2">
                                </div>
                                <p>（支持.jpg/.png 格式，建议尺寸90*90px，不能超过200kb)</p>
                            </div>

                        </div>
                        <div class="layui-form-item required">
                            <label class="layui-form-label">昵称</label>
                            <div class="layui-input-block nc">
                                <div class="nc-total">
                                    <span>0</span>/8
                                </div>
                                <input type="text" maxlength='8' name="title" lay-verify="title" autocomplete="off"
                                    placeholder="请输入昵称" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">个人简介</label>
                            <div class="layui-input-block">
                                <textarea name="" required lay-verify="required" placeholder="请输入个人简介"
                                    class="layui-textarea"></textarea>
                            </div>
                        </div>
                        <div class="layui-form-item" id="area-picker">
                            <label class="layui-form-label">所在地</label>

                            <div class="layui-input-inline" style="width: 200px;">
                                <select name="province" class="province-selector" data-value="广东省"
                                    lay-filter="province-1">
                                    <option value="">请选择省</option>
                                </select>
                            </div>
                            <div class="layui-input-inline" style="width: 200px;">
                                <select name="city" class="city-selector" data-value="深圳市" lay-filter="city-1">
                                    <option value="">请选择市</option>
                                </select>
                            </div>

                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label required">所在公司</label>
                            <div class="layui-input-block szgs w300">
                                <input type="text" name="title" lay-verify="title" autocomplete="off"
                                    placeholder="请输入公司名称" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label required">姓名</label>
                            <div class="layui-input-block w300">
                                <input type="text" name="title" lay-verify="title" autocomplete="off"
                                    placeholder="请输入姓名" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label required">所在部门</label>
                            <div class="layui-input-block w300">
                                <input type="text" name="title" lay-verify="title" autocomplete="off"
                                    placeholder="请输入所在部门" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label required">职位</label>
                            <div class="layui-input-block w300">
                                <input type="text" name="title" lay-verify="title" autocomplete="off"
                                    placeholder="请输入职位" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label required">工作证明</label>
                            <div class="layui-input-block gzzm">
                                <div style="display: flex; align-items: center;">
                                    <div class="layui-upload-drag" id="test10">
                                        <img src="/images/add.png" />
                                        <div class="layui-hide" id="uploadDemoView">
                                            <hr>
                                            <img src="" alt="上传成功后渲染" style="max-width: 196px">
                                        </div>
                                    </div>
                                    <div id="worke" style="display: flex;align-items: center;"></div>

                                    <div class="example">
                                        <label>实例：</label>
                                        <div class="example-wrap">
                                            <img
                                                src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=2872644965,1833653440&fm=15&gp=0.jpg" />
                                        </div>
                                    </div>
                                </div>
                                <p>（支持.jpg/.png 格式，建议尺寸200*200px,不能超过200kb)</p>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">联系方式</label>
                            <div class="layui-input-block lxfs-box">
                                <div class="lxfs">
                                    <div class="lxfs-item">
                                        <img src="/images/cs-phone.png" />
                                        <input type="text" name="title" lay-verify="title" autocomplete="off"
                                            placeholder="电话" class="layui-input">
                                    </div>
                                    <div class="lxfs-item">
                                        <img src="/images/wechat.png" />
                                        <input type="text" name="title" lay-verify="title" autocomplete="off"
                                            placeholder="微信" class="layui-input">
                                    </div>
                                    <div class="lxfs-item">
                                        <img src="/images/qq.png" />
                                        <input type="text" name="title" lay-verify="title" autocomplete="off"
                                            placeholder="QQ"" class=" layui-input">
                                    </div>
                                    <div class="lxfs-item">
                                        <img src="/images/email.png" />
                                        <input type="text" name="title" lay-verify="title" autocomplete="off"
                                            placeholder="电子邮箱" class="layui-input">
                                    </div>
                                </div>
                                <p>（联系电话、微信号、QQ至少填一项）</p>
                            </div>
                        </div>
                        <div class="layui-form-item" style="padding-top: 65px;">
                            <label class="layui-form-label"></label>
                            <div class="layui-input-block w175">
                                <button type="button" class="layui-btn update-info"
                                    style="background:#1BBC9C;">修改资料</button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="layui-tab-item safe-setting-cont">
                    <ul class="safe">
                        <li>
                            <label>手机</label>
                            <div class="safe-cont is-none" data-bind="-1">
                                <img src="../images/warn.png" />
                                <span class="safe-unbind">未绑定</span>
                            </div>
                            <div class="safe-cont" data-bind="1">
                                <img src="../images/check.png" />
                                <span class="safe-unbind">
                                    已绑定：158****2467
                                </span>
                            </div>
                            <span class="safe-btn" data-target="phone">
                                <button type="button" class="layui-btn is-none" data-bind="-1">立即绑定</button>
                                <button type="button" class="update-btn" data-bind="1">修改</button>
                            </span>
                        </li>
                        <li>
                            <label>邮箱</label>
                            <div class="safe-cont is-none" data-bind="-1">
                                <img src="../images/warn.png" />
                                <span class="safe-unbind">未绑定</span>
                            </div>
                            <div class="safe-cont" data-bind="1">
                                <img src="../images/check.png" />
                                <span class="safe-unbind">
                                    已绑定：55408**40@qq.com
                                </span>
                            </div>
                            <span class="safe-btn" data-target="email">
                                <button type="button" class="layui-btn is-none" data-bind="-1">立即绑定</button>
                                <button type="button" class="update-btn" data-bind="1">修改</button>
                            </span>
                        </li>
                        <li>
                            <label>密码</label>
                            <div class="safe-cont is-none" data-bind="-1">
                                <img src="../images/warn.png" />
                                <div>
                                    <span>未绑定</span>
                                    <p>密码要求至少包含字母，符号或数字中的两项且长度超过6位</p>
                                    <p>建议您经常修改密码，以保证帐号更加安全。</p>
                                </div>
                            </div>
                            <div class="safe-cont" data-bind="1">
                                <img src="../images/check.png" />
                                <div>
                                    <p>密码要求至少包含字母，符号或数字中的两项且长度超过6位</p>
                                    <p>建议您经常修改密码，以保证帐号更加安全。</p>
                                </div>
                            </div>
                            <span class="safe-btn" data-target="password">
                                <button type="button" class="layui-btn is-none" data-bind="-1">立即绑定</button>
                                <button type="button" class="update-btn" data-bind="1">修改</button>
                            </span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="/js/viewer.js"></script>
<script>
    $(function () {

        //配置插件目录
        layui.config({
            base: './mods/'
            , version: '1.0'
        });
        layui.use(['element', 'form', 'upload', 'layer', 'layarea'], function () {
            var element = layui.element; //Tab的切换功能，切换事件监听等，需要依赖element模块
            var form = layui.form;
            var upload = layui.upload;
            var layer = layui.layer;
            var layarea = layui.layarea;
            var passwordIndex = null,
                emailIndex = null,
                phoneIndex = null,
                url = location.pathname;
            var phoneTime = 60;
            var phoneTimer = null;

            var emailTime = 60;
            var emailTimer = null;


            $('body').undelegate('.email-dialog .is-send', 'click').delegate('.email-dialog .is-send', 'click', function () {
                var $this = $(this);
                var val = $('.email-input').val()
                if (!val) {
                    layer.msg('email不能为空')
                    return
                }
                countDown(emailTime, emailTimer, $this)
                layer.alert('修改成功！该弹窗只为做测试，并无实际效果')
            })

            $('body').undelegate('.phone-dialog .is-send', 'click').delegate('.phone-dialog .is-send', 'click', function () {
                var $this = $(this);
                var val = $('.phone-input').val()
                if (!val) {
                    layer.msg('phone不能为空')
                    return
                }
                countDown(phoneTime, phoneTimer, $this)
            })

            function countDown(time, timer, dom) {
                timer = setInterval(() => {
                    time--;
                    if (time === 0) {
                        clearInterval(timer)
                        time = 60;
                        dom.text(`发送验证码`)
                    } else {
                        dom.text(`已发送(${time}s)`)
                    }

                }, 1000);
            }



            $('.update-info').off('click').on('click', function () {
                $.Toast('标题', '内容', 'success', {
                    position_class: 'toast-top-right',
                    stack: true
                })
            })

            //编辑资料
            $('.edit-zl').off('click').on('click', function () {
                $('.personal-data--info-other2').addClass('is-none');
                $('.personal-data--info-other').removeClass('is-none')
            })

            //设置默认的tab
            if (url.includes('personal-data')) {
                $('li.personal-data1', '.layui-tab-title').addClass('layui-this').siblings().removeClass('layui-this')
                $('.personal-data-cont').addClass('layui-show').siblings().removeClass('layui-show')
            } else {
                $('li.safe-setting', '.layui-tab-title').addClass('layui-this').siblings().removeClass('layui-this')
                $('.safe-setting-cont').addClass('layui-show').siblings().removeClass('layui-show')
            }

            //按钮弹窗
            $('.safe-btn').on('click', function () {
                let target = $(this).data('target');
                if (target === 'password') openBindPassword()
                if (target === 'email') openBindEmail()
                if (target === 'phone') openBindPhone()

            })
            //绑定密码弹窗
            function openBindPassword() {
                passwordIndex = layer.open({
                    type: 1,
                    skin: 'phone-dialog-cs',
                    title: false,
                    closeBtn: false,
                    area: ['400px', '332px'],
                    content: `
                        <div class="dialog-box">
                            <div class="box-close" data-val="password">
                                <img src="/images/close.png" />    
                            </div>
                            <div class="box-title">修改密码</div>
                            <div class="box-cont">
                                <div class="box-cont-item">
                                    <input type="password" name="title" lay-verify="title" placeholder="请输入原密码" class="layui-input">
                                </div>
                                <div class="box-cont-item">
                                    <input type="password" name="title" lay-verify="title" placeholder="请输入6-30位的新密码" class="layui-input">
                                </div>
                                <div class="box-cont-item">
                                    <input type="password" name="title" lay-verify="title" placeholder="确认新密码" class="layui-input">
                                </div>
                            </div>
                            <div class="dialog-btns">
                                <span class="dialog-cancel" data-val="password">取消</span>
                                <span class="dialog-submit">确定</span>    
                            </div>
                        </div>
                    `
                });
            }
            //绑定邮箱弹窗
            function openBindEmail() {
                emailIndex = layer.open({
                    type: 1,
                    skin: 'phone-dialog-cs',
                    title: false,
                    closeBtn: false,
                    area: ['400px', '274px'],
                    content: `
                        <div class="email-dialog dialog-box">
                            <div class="box-close" data-val="email">
                                <img src="/images/close.png" />    
                            </div>
                            <div class="box-title">绑定邮箱账号</div>
                            <div class="box-cont">
                                <div class="box-cont-item">
                                    <input placeholder="请输入邮箱号码"  class="layui-input email-input">
                                </div>
                                <div class="box-cont-item send-ipt">
                                    <input  placeholder="请输入邮箱验证码" class="layui-input">
                                    <div class="send-btns">
                                        <span class="is-send">发送邮件</span>
                                    </div>
                                </div>
                            </div>
                            <div class="dialog-btns">
                                <span class="dialog-cancel" data-val="email">取消</span>
                                <span class="dialog-submit">确定</span>    
                            </div>
                        </div>
                    `
                });
            }
            //绑定手机号弹窗
            function openBindPhone() {
                phoneIndex = layer.open({
                    type: 1,
                    skin: 'phone-dialog-cs',
                    title: false,
                    closeBtn: false,
                    area: ['400px', '304px'],
                    content: `
                        <div class="phone-dialog dialog-box">
                            <div class="box-close" data-val="phone">
                                <img src="/images/close.png" />    
                            </div>
                            <div class="box-title">修改手机号码</div>
                            <div class="box-cont">
                                <div class="has-phone-number">
                                    <label>现在手机：</label>
                                    156****3741
                                </div>
                                <div class="box-cont-item">
                                    <input type="text"  placeholder="请输入手机号码" maxLength="11" class="layui-input phone-input">
                                </div>
                                <div class="box-cont-item send-ipt">
                                    <input  placeholder="请输入手机验证码" class="layui-input">
                                    <div class="send-btns">
                                        <span class="is-send">发送邮件</span>
                                    </div>
                                </div>
                            </div>
                            <div class="dialog-btns">
                                <span class="dialog-cancel" data-val="phone">暂不修改</span>
                                <span class="dialog-submit">确定</span>    
                            </div>
                        </div>
                    `
                });
            }

            //关闭弹窗
            $(document).undelegate('.box-close', 'click').delegate('.box-close', 'click', function () {
                onCloseDialog(this)
            })
            //取消按钮事件
            $(document).undelegate('.dialog-cancel', 'click').delegate('.dialog-cancel', 'click', function () {
                onCloseDialog(this)
            })

            //关闭弹窗事件
            function onCloseDialog(el) {
                let val = $(el).data('val');
                if (val == "password") layer.close(passwordIndex)
                if (val == "email") layer.close(emailIndex)
                if (val == "phone") layer.close(phoneIndex)
            }

            //昵称输入框 事件
            $('input', '.nc').on('input', function () {
                let text = $(this).val();
                let totalEl = $(this).prev('.nc-total')
                totalEl.children('span').empty().append(text.length)
            })

            layarea.render({
                elem: '#area-picker',
                change: function (res) {
                    //选择结果
                    console.log(res);
                }
            });
            upload.render({
                elem: '#user-head'
                , url: 'https://httpbin.org/post' //改成您自己的上传接口
                , multiple: true
                , before: function (obj) {
                    //预读本地文件示例，不支持ie8
                    obj.preview(function (index, file, result) {
                        $('.upload-image').css('display', 'none')
                        $('#demo2').css({
                            width: '90px',
                            height: '90px',
                            overflow: 'hidden',
                            borderRadius: '50%',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            border: '1px solid #eee'
                        })

                        var style = null; //定义存储图片样式变量
                        //获取图片真实宽高
                        var img = new Image();
                        img.src = result;
                        $(img).css('object-fit','contain')
                        img.onload = function(){
                           var imgWidth = img.width,
                               imgHeight = img.height;
                            if(imgWidth > imgHeight){
                                $(img).css('max-width','90px')
                            }else{
                                $(img).css('max-height','90px')
                            }
                            $('#demo2').empty().append(img)
                        }

                        // $('#demo2').empty().append('<img src="' + result + '" alt="' + file.name + '" class="layui-upload-img" style="max-width: 90px;">')

                    });
                }
                , done: function (res) {
                    //上传完毕
                }
            });

            //多图片上传
            upload.render({
                elem: '#test10'
                , url: 'https://httpbin.org/post' //改成您自己的上传接口
                , multiple: true
                , before: function (obj) {
                    //预读本地文件示例，不支持ie8
                    obj.preview(function (index, file, result) {
                        let html = `
                            <div class="upload-img__box">
                                <span class="work-img-mask">
                                    <img class="delete" src="/images/delete.png" /> 
                                    <img class="eye" src="/images/eye2.png" />   
                                </span>
                                <img src="${result}" alt="${file.name}"  class="layui-upload-img" style="max-width:100%;" />
                            </div>`
                        $('#worke').append(html)
                    });
                }
                , done: function (res) {
                    //上传完毕
                }
            });
          
            //删除图片
            $('#worke').undelegate('.work-img-mask .delete', 'click').delegate('.work-img-mask .delete', 'click', function () {
                let targetDom = $(this).parent('.work-img-mask').parent('.upload-img__box');
                layer.confirm('是否删除工作证明？', {
                    title: '提示',
                    btn: ['确定', '取消'] //按钮
                }, function (index) {
                    targetDom.remove();
                    layer.close(index)
                }, function () {
                    //cancel
                });
            })

        })
        $('#worke').undelegate('.work-img-mask .eye', 'click').delegate('.work-img-mask .eye', 'click', function () {
            let imageTarget = $(this).parent('.work-img-mask').next('img');
            console.log(imageTarget)
            previewImg(imageTarget[0])
        })

        $('.example-wrap img').off('click').on('click',function(){
            previewImg(this)
        })

        function previewImg(obj) {
            var img = new Image();
            img.src = obj.src;
            var height = img.height + 50; //获取图片高度
            var width = img.width; //获取图片宽度
            var imgHtml = "<img src='" + obj.src + "' />";
            //弹出层
            layer.open({
                type: 1,
                shade: 0.8,
                offset: 'auto',
                area: [width + 'px', height + 'px'],
                shadeClose: true,//点击外围关闭弹窗
                scrollbar: false,//不现实滚动条
                title: "图片预览", //不显示标题  
                content: imgHtml, //捕获的元素，注意：最好该指定的元素要存放在body最外层，否则可能被其它的相对元素所影响  
                cancel: function () {
                    //layer.msg('捕获就是从页面已经存在的元素上，包裹layer的结构', { time: 5000, icon: 6 });  
                }
            });
        }
    })
</script>